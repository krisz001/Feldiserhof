<%
  // ---- menuData safe fallback ----
  const rawMenu = (typeof menuData !== 'undefined' && menuData) ? menuData : {};
  const categories = Array.isArray(rawMenu.categories) ? rawMenu.categories : [];

  // C√≠msorok ‚Äì vagy az include-b√≥l kapott √©rt√©keket haszn√°ljuk, vagy a menuData.title-t, vagy alap DE sz√∂veget
  const titleTxt    = (typeof menuTitle    !== 'undefined' && menuTitle)    ? menuTitle    : (rawMenu.title || 'Speisekarte');
  const subtitleTxt = (typeof menuSubtitle !== 'undefined' && menuSubtitle) ? menuSubtitle : 'Entdecken Sie unsere K√ºche';
  const introTxt    = (typeof menuIntro    !== 'undefined' && menuIntro)    ? menuIntro    : 'Frisch, saisonal, regional ‚Äì t√§glich f√ºr Sie.';

  // flags safe
  const safeFlags = (typeof flags !== 'undefined' && flags) ? flags : {};
%>

<section id="menu" class="menu-section">
  <header class="menu-header text-center mb-5">
    <span class="menu-icon" aria-hidden="true">üç¥</span>
    <h2 class="menu-title"><%= titleTxt %></h2>
    <div class="menu-divider"></div>
    <p class="menu-subtitle"><%= subtitleTxt %></p>
    <p class="menu-intro"><%= introTxt %></p>
  </header>

  <!-- üîí wrapper kap felt√©teles locked √°llapotot -->
  <div class="menu-portfolio <%= safeFlags.menuBookEnabled ? '' : 'is-locked' %>">
    <div class="wrapper">

      <!-- üîí ha tiltva van, mutatjuk az overlay √ºzenetet -->
      <% if (!safeFlags.menuBookEnabled) { %>
        <div class="book-lock-overlay" role="status" aria-live="polite">
          <div class="blo-card">
            <h3>Wegen Betriebsferien ist unsere Speisekarte momentan nicht verf√ºgbar.</h3>
            <p>Wir freuen uns, Sie bald wieder begr√º√üen zu d√ºrfen.</p>
          </div>
        </div>
      <% } %>

      <div class="cover cover-left" aria-hidden="true"></div>
      <div class="cover cover-right" aria-hidden="true"></div>

      <div class="book" id="menuBook">
        <!-- Bal nyit√≥ oldal -->
        <div class="book-page page-left">
          <div class="profile-page profile-cover">
            <h1><%= titleTxt %></h1>
            <p><%= subtitleTxt %></p>
          </div>
        </div>

        <!-- Jobb oldal SABLON ‚Äì JS dinamikusan t√∂lti fel (fallback tartalommal) -->
        <div class="book-page page-right" data-sheet="1" id="turn-1" data-template="page">
          <div class="page-front">
            <h1 class="title"><%= titleTxt %></h1>
            <div class="menu-items-grid">
              <% if (!categories || !categories.length) { %>
                <article class="menu-item">
                  <p>Derzeit sind keine Men√ºdaten vorhanden.</p>
                </article>
              <% } %>
            </div>
            <span class="number-page">1</span>
            <span class="nextprev-btn" data-role="next">
              <i class="bx bx-chevron-right"></i>
            </span>
          </div>

          <div class="page-back">
            <h1 class="title"></h1>
            <div class="menu-items-grid"></div>
            <span class="number-page"></span>
            <span class="nextprev-btn back" data-role="prev">
              <i class="bx bx-chevron-left"></i>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="book-dots"></div>
  </div>

  <link rel="stylesheet" href="/css/menu-portfolio-book.css">
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">

  <!-- Men√º adat be√°gyaz√°sa a DOM-ba a dinamikus lapoz√°shoz -->
  <script id="menuDataScript" type="application/json">
    <%- JSON
        .stringify(rawMenu)
        // biztos, ami biztos: ne t√∂rdje el a </script>
        .replace(/<\/(script)/gi, '<\\/$1')
    %>
  </script>

  <!-- Dinamikus, magass√°g-alap√∫ oldalgener√°l√°s + lapoz√°s -->
  <script src="/js/feldiserhof-menu-book.js" defer></script>
</section>

<div class="section-separator"></div>

<!-- üîΩ csak ehhez az opci√≥hoz sz√ºks√©ges minim√°l st√≠lus -->
<style>
  .menu-portfolio .wrapper { position: relative; }
  .menu-portfolio.is-locked .cover,
  .menu-portfolio.is-locked .book {
    filter: blur(14px) brightness(0.85) saturate(0.9);
    pointer-events: none !important;
    user-select: none !important;
  }
  .book-lock-overlay{
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
    padding: 24px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,.18), rgba(0,0,0,.28));
    z-index: 999;
  }
  .book-lock-overlay .blo-card{
    max-width: 720px; width: 100%;
    text-align: center; padding: 28px 24px; border-radius: 16px;
    background: rgba(255,255,255,.9);
    box-shadow: 0 20px 60px rgba(0,0,0,.25);
    backdrop-filter: blur(4px);
  }
  .book-lock-overlay .blo-card h3{
    margin:0 0 8px;
    font-weight:700;
    font-size: clamp(1.1rem,2.2vw,1.5rem);
    color:#2b2b2b;
  }
  .book-lock-overlay .blo-card p {
    margin:0;
    font-size: clamp(.95rem,2vw,1.05rem);
    color:#444;
  }

  @media (prefers-color-scheme: dark){
    .book-lock-overlay .blo-card{ background: rgba(26,26,26,.92); color:#eee; }
    .book-lock-overlay .blo-card h3{ color:#fff; }
    .book-lock-overlay .blo-card p { color:#ddd; }
  }

  /* finom "shake", ha tiltott √°llapotban pr√≥b√°l lapozni (ha haszn√°lod) */
  @keyframes book-shake{
    10%,90%{transform:translateX(-1px)}
    20%,80%{transform:translateX(2px)}
    30%,50%,70%{transform:translateX(-4px)}
    40%,60%{transform:translateX(4px)}
  }
  .menu-portfolio .book.shake{ animation: book-shake .4s both; }
</style>
