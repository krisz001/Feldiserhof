<%
  // --------- Adatok el≈ëk√©sz√≠t√©se ---------
  const categories = (menuData && Array.isArray(menuData.categories)) ? menuData.categories : [];
  const titleTxt    = t('menu.title',    { defaultValue: 'Speisekarte' });
  const subtitleTxt = t('menu.subtitle', { defaultValue: 'Entdecken Sie unsere K√ºche' });
  const introTxt    = t('menu.intro',    { defaultValue: 'Frisch, saisonal, regional ‚Äì t√§glich f√ºr Sie.' });

  const itemsPerPage = 8; // Maxim√°lis t√©tel oldalank√©nt

  const pages = [];
  categories.forEach((cat, catIndex) => {
    const items = Array.isArray(cat.items) ? cat.items : [];
    for (let i = 0; i < items.length; i += itemsPerPage) {
      const pageItems   = items.slice(i, i + itemsPerPage);
      const pageNoInCat = Math.floor(i / itemsPerPage) + 1;
      const baseName    = cat.name || ('Kategorie ' + (catIndex + 1));
      const pageTitle   = pageNoInCat === 1 ? baseName : `${baseName} (Seite ${pageNoInCat})`;
      pages.push({ title: pageTitle, items: pageItems });
    }
  });
  const totalSheets = Math.ceil(pages.length / 2);
%>

<section id="menu" class="menu-section">
  <!-- MODERN HEADER -->
  <header class="menu-header text-center mb-5">
    <span class="menu-icon" aria-hidden="true">üç¥</span>
    <h2 class="menu-title"><%= titleTxt %></h2>
    <div class="menu-divider"></div>
    <p class="menu-subtitle"><%= subtitleTxt %></p>
    <p class="menu-intro"><%= introTxt %></p>
  </header>

  <div class="menu-portfolio">
    <div class="wrapper">
      <div class="cover cover-left" aria-hidden="true"></div>
      <div class="cover cover-right" aria-hidden="true"></div>

      <div class="book">
        <div class="book-page page-left">
          <div class="profile-page profile-cover">
            <h1><%= titleTxt %></h1>
            <p><%= subtitleTxt %></p>
          </div>
        </div>

        <% if (pages.length === 0) { %>
          <div class="book-page page-right" id="turn-1">
            <div class="page-front">
              <h1 class="title"><%= titleTxt %></h1>
              <p>Derzeit sind keine Men√ºdaten vorhanden.</p>
              <span class="number-page">1</span>
              <span class="nextprev-btn" data-role="next"><i class="bx bx-chevron-right"></i></span>
            </div>
            <div class="page-back">
              <span class="number-page">2</span>
              <span class="nextprev-btn back" data-role="prev"><i class="bx bx-chevron-left"></i></span>
            </div>
          </div>
        <% } else {
          for (let sheetIndex = 0; sheetIndex < totalSheets; sheetIndex++) {
            const front        = pages[sheetIndex * 2];
            const back         = pages[sheetIndex * 2 + 1];
            const sheetId      = `turn-${sheetIndex + 1}`;
            const frontPageNo  = sheetIndex * 2 + 1;
            const backPageNo   = sheetIndex * 2 + 2;
        %>
          <div class="book-page page-right" id="<%= sheetId %>">
            <!-- FRONT -->
            <div class="page-front">
              <h1 class="title"><%= front.title %></h1>
              <div class="menu-items-grid">
                <% front.items.forEach(item => { %>
                  <article class="menu-item">
                    <div class="mi-head">
                      <h4 class="mi-name"><%- item.name || '' %></h4>
                      <% if (item.price != null && item.price !== '') { %>
                        <div class="mi-price">
                          <%= typeof item.price === 'number' ? item.price.toFixed(2) + ' fr' : String(item.price) %>
                        </div>
                      <% } %>
                    </div>
                    <% if (item.desc) { %>
                      <p class="mi-desc"><%- item.desc %></p>
                    <% } %>
                    <% if (item.tags && item.tags.length) { %>
                      <ul class="mi-tags">
                        <% item.tags.forEach(tag => { %><li><%- tag %></li><% }) %>
                      </ul>
                    <% } %>
                    <% if (item.allergens && item.allergens.length) { %>
                      <ul class="mi-tags allergens">
                        <% item.allergens.forEach(allergen => { %><li class="allergen"><%- allergen %></li><% }) %>
                      </ul>
                    <% } %>
                  </article>
                <% }) %>
              </div>
              <span class="number-page"><%= frontPageNo %></span>
              <span class="nextprev-btn" data-role="next"><i class="bx bx-chevron-right"></i></span>
            </div>
            <!-- BACK -->
            <div class="page-back">
              <% if (back) { %>
                <h1 class="title"><%= back.title %></h1>
                <div class="menu-items-grid">
                  <% back.items.forEach(item => { %>
                    <article class="menu-item">
                      <div class="mi-head">
                        <h4 class="mi-name"><%- item.name || '' %></h4>
                        <% if (item.price != null && item.price !== '') { %>
                          <div class="mi-price">
                            <%= typeof item.price === 'number' ? item.price.toFixed(2) + ' fr' : String(item.price) %>
                          </div>
                        <% } %>
                      </div>
                      <% if (item.desc) { %>
                        <p class="mi-desc"><%- item.desc %></p>
                      <% } %>
                      <% if (item.tags && item.tags.length) { %>
                        <ul class="mi-tags">
                          <% item.tags.forEach(tag => { %><li><%- tag %></li><% }) %>
                        </ul>
                      <% } %>
                      <% if (item.allergens && item.allergens.length) { %>
                        <ul class="mi-tags allergens">
                          <% item.allergens.forEach(allergen => { %><li class="allergen"><%- allergen %></li><% }) %>
                        </ul>
                      <% } %>
                    </article>
                  <% }) %>
                </div>
              <% } else { %>
                <div class="profile-page">
                  <h1 class="title">Vielen Dank!</h1>
                  <p>Wir w√ºnschen einen guten Appetit</p>
                </div>
              <% } %>
              <span class="number-page"><%= backPageNo %></span>
              <span class="nextprev-btn back" data-role="prev"><i class="bx bx-chevron-left"></i></span>
            </div>
          </div>
        <% } } %>
      </div>
    </div>
    <div class="book-dots"></div>
  </div>
  <link rel="stylesheet" href="/css/menu-portfolio-book.css">
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
</section>
<div class="section-separator"></div>
